<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TDEE Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F0F8FF; /* Pastel blue */
        }
        .emoji {
            position: absolute;
            font-size: 2rem;
            animation-iteration-count: infinite;
            pointer-events: none;
            opacity: 0.8;
            z-index: -1;
        }
        @keyframes float {
            0% { transform: translate(0, 0) rotate(0deg); opacity: 0.8; }
            50% { transform: translate(calc(var(--rand-x) * 1px), calc(var(--rand-y) * 1px)) rotate(calc(var(--rand-rot) * 1deg)); opacity: 0.6; }
            100% { transform: translate(0, 0) rotate(0deg); opacity: 0.8; }
        }
    </style>
</head>
<body class="bg-blue-50 p-4">
    <!-- Floating Emojis -->
    <div id="emoji-container"></div>

    <div id="calculator-view" class="bg-white p-6 md:p-10 rounded-3xl shadow-xl w-full max-w-2xl mx-auto my-8 transform transition-all duration-300 relative z-10">
        <h1 class="text-3xl md:text-4xl font-bold text-center text-gray-900 mb-2">
            ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì TDEE
        </h1>
        <p class="text-sm md:text-base text-center text-gray-600 mb-6 md:mb-8 tracking-wide">
            ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ß‡∏±‡∏ô
        </p>

        <form id="tdee-form" class="space-y-4 md:space-y-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
                <div>
                    <label for="gender" class="block text-gray-700 font-medium mb-1 md:mb-2 text-sm md:text-base">‡πÄ‡∏û‡∏®</label>
                    <select id="gender" class="w-full p-3 md:p-4 border border-blue-200 rounded-xl focus:ring-blue-300 focus:border-blue-300 transition-colors duration-200 appearance-none text-sm md:text-base">
                        <option value="male">‡∏ä‡∏≤‡∏¢</option>
                        <option value="female">‡∏´‡∏ç‡∏¥‡∏á</option>
                    </select>
                </div>
                <div>
                    <label for="age" class="block text-gray-700 font-medium mb-1 md:mb-2 text-sm md:text-base">‡∏≠‡∏≤‡∏¢‡∏∏ (‡∏õ‡∏µ)</label>
                    <input type="number" id="age" min="1" class="w-full p-3 md:p-4 border border-blue-200 rounded-xl focus:ring-blue-300 focus:border-blue-300 transition-colors duration-200 text-sm md:text-base" required>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
                <div>
                    <label for="weight" class="block text-gray-700 font-medium mb-1 md:mb-2 text-sm md:text-base">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°)</label>
                    <input type="number" id="weight" step="0.1" min="1" class="w-full p-3 md:p-4 border border-blue-200 rounded-xl focus:ring-blue-300 focus:border-blue-300 transition-colors duration-200 text-sm md:text-base" required>
                </div>
                <div>
                    <label for="height" class="block text-gray-700 font-medium mb-1 md:mb-2 text-sm md:text-base">‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á (‡πÄ‡∏ã‡∏ô‡∏ï‡∏¥‡πÄ‡∏°‡∏ï‡∏£)</label>
                    <input type="number" id="height" step="0.1" min="1" class="w-full p-3 md:p-4 border border-blue-200 rounded-xl focus:ring-blue-300 focus:border-blue-300 transition-colors duration-200 text-sm md:text-base" required>
                </div>
            </div>
            <div>
                <label for="activity" class="block text-gray-700 font-medium mb-1 md:mb-2 text-sm md:text-base">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</label>
                <select id="activity" class="w-full p-3 md:p-4 border border-blue-200 rounded-xl focus:ring-blue-300 focus:border-blue-300 transition-colors duration-200 appearance-none text-sm md:text-base">
                    <option value="1.2">‡πÑ‡∏°‡πà‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡πÄ‡∏•‡∏¢</option>
                    <option value="1.375">‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏ô‡πâ‡∏≠‡∏¢ (1-3 ‡∏ß‡∏±‡∏ô/‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå)</option>
                    <option value="1.55">‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á (3-5 ‡∏ß‡∏±‡∏ô/‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå)</option>
                    <option value="1.725">‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏´‡∏ô‡∏±‡∏Å (6-7 ‡∏ß‡∏±‡∏ô/‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå)</option>
                    <option value="1.9">‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤ (‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏•‡∏∞ 2 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á)</option>
                </select>
            </div>
            <div>
                <label for="goal" class="block text-gray-700 font-medium mb-1 md:mb-2 text-sm md:text-base">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</label>
                <select id="goal" class="w-full p-3 md:p-4 border border-blue-200 rounded-xl focus:ring-blue-300 focus:border-blue-300 transition-colors duration-200 appearance-none text-sm md:text-base">
                    <option value="normal">‡∏ä‡πà‡∏ß‡∏á‡∏õ‡∏Å‡∏ï‡∏¥</option>
                    <option value="weightLoss">‡∏ä‡πà‡∏ß‡∏á‡∏•‡∏î‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (‡πÅ‡∏Ñ‡∏•‡∏≠‡∏£‡∏µ‡πà 75% ‡∏Ç‡∏≠‡∏á TDEE)</option>
                </select>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 mt-4">
                <button type="submit" id="meal-button" class="w-full bg-blue-500 text-white font-semibold py-3 md:py-4 rounded-xl hover:bg-blue-600 transition-colors duration-200 shadow-md text-base md:text-lg">
                    ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏°‡∏∑‡πâ‡∏≠‡∏≠‡∏≤‡∏´‡∏≤‡∏£
                </button>
                <button type="button" id="workout-button" class="w-full bg-blue-500 text-white font-semibold py-3 md:py-4 rounded-xl hover:bg-blue-600 transition-colors duration-200 shadow-md text-base md:text-lg">
                    ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢
                </button>
            </div>
        </form>
    </div>

    <div id="result-view" class="bg-white p-6 md:p-10 rounded-3xl shadow-xl w-full max-w-2xl mx-auto my-8 transform transition-all duration-300 relative z-10 hidden">
        <h2 id="result-title" class="text-xl md:text-2xl font-bold text-gray-900 text-center mb-4"></h2>
        <p class="text-base md:text-lg text-gray-700 text-center mb-6">
            ‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: <span id="final-calories" class="font-bold text-gray-900"></span> ‡∏Å‡∏¥‡πÇ‡∏•‡πÅ‡∏Ñ‡∏•‡∏≠‡∏£‡∏µ‡πà/‡∏ß‡∏±‡∏ô
        </p>
        <div id="meal-section">
            <h3 class="text-lg md:text-xl font-semibold text-gray-900 text-center mb-4">
                ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£ 3 ‡∏°‡∏∑‡πâ‡∏≠
            </h3>
            <div id="meal-plan" class="space-y-4"></div>
        </div>
        <div id="workout-section" class="mt-8">
            <h3 class="text-lg md:text-xl font-semibold text-gray-900 text-center mb-4">
                ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢
            </h3>
            <p class="text-base md:text-lg text-gray-700 text-center mb-6">
                ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏õ‡∏Å‡∏ï‡∏¥: <span id="tdee-difference" class="font-bold text-gray-900"></span> ‡∏Å‡∏¥‡πÇ‡∏•‡πÅ‡∏Ñ‡∏•‡∏≠‡∏£‡∏µ‡πà/‡∏ß‡∏±‡∏ô
            </p>
            <div id="workout-program" class="space-y-4"></div>
        </div>
        <button id="back-button" class="w-full bg-gray-300 text-gray-800 font-semibold py-3 md:py-4 rounded-xl hover:bg-gray-400 transition-colors duration-200 shadow-md text-base md:text-lg mt-8">
            ‡∏Å‡∏•‡∏±‡∏ö
        </button>
    </div>

    <script>
        // API Key and URL for Google Gemini API
        const apiKey = 'AIzaSyAPzP3da8pDTT9iUZBGIljAg0bgB2W8Zig';
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

        // Function to handle form submission for meal plan
        document.getElementById('meal-button').addEventListener('click', async function(event) {
            event.preventDefault();
            await handleCalculation('meal');
        });

        // Function to handle workout button click
        document.getElementById('workout-button').addEventListener('click', async function(event) {
            event.preventDefault();
            await handleCalculation('workout');
        });

        async function handleCalculation(mode) {
            const gender = document.getElementById('gender').value;
            const age = parseFloat(document.getElementById('age').value);
            const weight = parseFloat(document.getElementById('weight').value);
            const height = parseFloat(document.getElementById('height').value);
            const activityFactor = parseFloat(document.getElementById('activity').value);
            const goal = document.getElementById('goal').value;

            // Validate inputs
            if (isNaN(age) || isNaN(weight) || isNaN(height) || age <= 0 || weight <= 0 || height <= 0) {
                 alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏≠‡∏≤‡∏¢‡∏∏, ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å, ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
                 return;
            }

            let bmr;
            if (gender === 'male') {
                bmr = (10 * weight) + (6.25 * height) - (5 * age) + 5;
            } else {
                bmr = (10 * weight) + (6.25 * height) - (5 * age) - 161;
            }

            const tdee = Math.round(bmr * activityFactor);
            let finalCalories = tdee;

            if (goal === 'weightLoss') {
                finalCalories = Math.round(tdee * 0.75);
            }

            // Calculate TDEE for sedentary lifestyle to find the difference
            const sedentaryTDEE = Math.round(bmr * 1.2);
            const tdeeDifference = tdee - sedentaryTDEE;

            document.getElementById('final-calories').textContent = finalCalories;
            
            document.getElementById('calculator-view').classList.add('hidden');
            document.getElementById('result-view').classList.remove('hidden');

            const mealSection = document.getElementById('meal-section');
            const workoutSection = document.getElementById('workout-section');
            const resultTitle = document.getElementById('result-title');
            
            // Set TDEE difference text
            document.getElementById('tdee-difference').textContent = tdeeDifference;

            if (mode === 'meal') {
                resultTitle.textContent = "‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå: ‡πÅ‡∏ú‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£";
                mealSection.classList.remove('hidden');
                workoutSection.classList.add('hidden');
                document.getElementById('meal-plan').innerHTML = '<p class="text-center text-gray-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£...</p>';
                await generateMealPlan(finalCalories, goal);
            } else if (mode === 'workout') {
                resultTitle.textContent = "‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå: ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢";
                mealSection.classList.add('hidden');
                workoutSection.classList.remove('hidden');
                document.getElementById('workout-program').innerHTML = '<p class="text-center text-gray-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢...</p>';
                await generateWorkoutPlan(activityFactor, gender, tdeeDifference);
            }
        }

        async function generateMealPlan(finalCalories, goal) {
            const mealPlanDiv = document.getElementById('meal-plan');
            try {
                const systemPromptMeal = "‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏î‡πâ‡∏≤‡∏ô‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö JSON ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô";
                let userQueryMeal = `‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£ 3 ‡∏°‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô ${finalCalories} ‡∏Å‡∏¥‡πÇ‡∏•‡πÅ‡∏Ñ‡∏•‡∏≠‡∏£‡∏µ‡πà‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≤‡∏ß‡∏´‡∏≠‡∏°‡∏°‡∏∞‡∏•‡∏¥‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÄ‡∏°‡∏ô‡∏π ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏°‡∏∑‡πâ‡∏≠‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏∏‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏Ç‡πâ‡∏≤‡∏ß‡∏´‡∏≠‡∏°‡∏°‡∏∞‡∏•‡∏¥‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏£‡∏±‡∏° ‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏™‡∏±‡∏ï‡∏ß‡πå (‡πÄ‡∏ä‡πà‡∏ô ‡πÑ‡∏Å‡πà, ‡∏´‡∏°‡∏π, ‡∏õ‡∏•‡∏≤) ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏£‡∏±‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏ô‡∏±‡πâ‡∏ô‡πÜ`;
                
                if (goal === 'weightLoss') {
                    userQueryMeal += " ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏°‡∏ô‡∏π‡∏ô‡∏µ‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏•‡∏î‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡πÅ‡∏Ñ‡∏•‡∏≠‡∏£‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°";
                }

                const payloadMeal = {
                    contents: [{ parts: [{ text: userQueryMeal }] }],
                    generationConfig: {
                        responseMimeType: "application/json",
                        responseSchema: {
                            type: "ARRAY",
                            items: {
                                type: "OBJECT",
                                properties: {
                                    "name": { "type": "STRING" },
                                    "description": { "type": "STRING" },
                                    "calories": { "type": "NUMBER" }
                                },
                                "propertyOrdering": ["name", "description", "calories"]
                            }
                        }
                    },
                    systemInstruction: {
                        parts: [{ text: systemPromptMeal }]
                    },
                };
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payloadMeal)
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`API response was not ok: ${response.status} ${response.statusText} - ${errorText}`);
                }

                const resultMeal = await response.json();
                const jsonTextMeal = resultMeal?.candidates?.[0]?.content?.parts?.[0]?.text;
                if (!jsonTextMeal) {
                    throw new Error('No content returned from the API for meal plan.');
                }
                
                const meals = JSON.parse(jsonTextMeal);
                renderMealPlan(meals);
            } catch (error) {
                console.error("Error generating meal plan:", error);
                mealPlanDiv.innerHTML = '<p class="text-center text-red-500">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>';
            }
        }

        async function generateWorkoutPlan(activityFactor, gender, tdeeDifference) {
            const workoutProgramDiv = document.getElementById('workout-program');
            try {
                const systemPromptWorkout = "‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡∏î‡πâ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°";
                let userQueryWorkout = `‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡πÅ‡∏ö‡∏ö‡∏ö‡∏≠‡∏î‡∏µ‡πâ‡πÄ‡∏ß‡∏ó ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏™‡∏£‡∏¥‡∏°‡πÅ‡∏Ñ‡πà‡∏î‡∏±‡∏°‡πÄ‡∏ö‡∏• 5 ‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏° ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≤‡∏£‡πå‡∏î‡∏¥‡πÇ‡∏≠ ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢ `;

                if (tdeeDifference > 200) {
                    userQueryWorkout += `‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏´‡∏ô‡∏±‡∏Å ‡πÇ‡∏î‡∏¢‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô ${tdeeDifference} ‡∏Å‡∏¥‡πÇ‡∏•‡πÅ‡∏Ñ‡∏•‡∏≠‡∏£‡∏µ‡πà‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô`;
                } else if (tdeeDifference > 100) {
                    userQueryWorkout += `‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á ‡πÇ‡∏î‡∏¢‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô ${tdeeDifference} ‡∏Å‡∏¥‡πÇ‡∏•‡πÅ‡∏Ñ‡∏•‡∏≠‡∏£‡∏µ‡πà‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô`;
                } else {
                    userQueryWorkout += `‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏ô‡πâ‡∏≠‡∏¢ ‡πÇ‡∏î‡∏¢‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô ${tdeeDifference} ‡∏Å‡∏¥‡πÇ‡∏•‡πÅ‡∏Ñ‡∏•‡∏≠‡∏£‡∏µ‡πà‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô`;
                }
                
                userQueryWorkout += ` ‡πÇ‡∏î‡∏¢‡∏™‡∏∏‡πà‡∏°‡∏ó‡πà‡∏≤‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Å‡∏±‡∏ö‡πÄ‡∏û‡∏®${gender === 'male' ? '‡∏ä‡∏≤‡∏¢' : '‡∏´‡∏ç‡∏¥‡∏á'}‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å`;

                const payloadWorkout = {
                    contents: [{ parts: [{ text: userQueryWorkout }] }],
                    systemInstruction: {
                        parts: [{ text: systemPromptWorkout }]
                    },
                };
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payloadWorkout)
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`API response was not ok: ${response.status} ${response.statusText} - ${errorText}`);
                }

                const resultWorkout = await response.json();
                const workoutText = resultWorkout?.candidates?.[0]?.content?.parts?.[0]?.text;
                if (workoutText) {
                    workoutProgramDiv.innerHTML = `<p class="whitespace-pre-wrap text-gray-600 text-sm">${workoutText}</p>`;
                } else {
                    workoutProgramDiv.innerHTML = '<p class="text-center text-red-500">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>';
                }

            } catch (error) {
                console.error("Error generating workout plan:", error);
                workoutProgramDiv.innerHTML = '<p class="text-center text-red-500">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ</p>';
            }
        }
        
        function renderMealPlan(meals) {
            const mealPlanDiv = document.getElementById('meal-plan');
            mealPlanDiv.innerHTML = '';

            meals.forEach(meal => {
                const mealItem = document.createElement('div');
                mealItem.className = 'p-4 rounded-lg bg-white shadow-sm border border-gray-100';
                mealItem.innerHTML = `
                    <h4 class="font-semibold text-gray-900 text-lg mb-1">${meal.name} (~${meal.calories || '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏ö‡∏∏'} kcal)</h4>
                    <p class="text-gray-600 text-sm">${meal.description}</p>
                `;
                mealPlanDiv.appendChild(mealItem);
            });
        }
        
        // Back button
        document.getElementById('back-button').addEventListener('click', function() {
            document.getElementById('calculator-view').classList.remove('hidden');
            document.getElementById('result-view').classList.add('hidden');
        });

        // Dynamic emoji generation and animation
        window.onload = function() {
            const emojis = ['‚ú®', 'üíñ', 'üå∏', 'ü¶ã', 'üåà', 'üíô', 'üíú'];
            const container = document.getElementById('emoji-container');

            for (let i = 0; i < 20; i++) {
                const emoji = document.createElement('span');
                emoji.className = 'emoji';
                emoji.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                
                // Randomize position and animation properties
                emoji.style.left = `${Math.random() * 100}%`;
                emoji.style.top = `${Math.random() * 100}%`;
                emoji.style.animationName = 'float';
                emoji.style.animationDuration = `${15 + Math.random() * 5}s`;
                emoji.style.animationDelay = `${Math.random() * -10}s`;
                emoji.style.setProperty('--rand-x', Math.random() * 50 - 25);
                emoji.style.setProperty('--rand-y', Math.random() * -50);
                emoji.style.setProperty('--rand-rot', Math.random() * 20 - 10);
                
                container.appendChild(emoji);
            }
        };
    </script>
</body>
</html>
